<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SQL Analysis Report</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 2em; background: #f9f9f9; color: #222; }
        h1, h2, h3 { color: #2c3e50; }
        .summary-card { background: #eaf6fb; border-radius: 8px; padding: 1em 2em; margin-bottom: 2em; box-shadow: 0 2px 6px #0001; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 2em; }
        th, td { border: 1px solid #bcd; padding: 0.5em 1em; text-align: left; }
        th { background: #e3eaf2; }
        tbody tr:nth-child(odd) { background: #f5f8fa; }
        .error-message { color: #b30000; background: #ffeaea; }
        details { margin-bottom: 1em; }
        summary { font-weight: bold; cursor: pointer; }
        code, pre { font-family: 'Fira Mono', 'Consolas', monospace; background: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>SQL Analysis Report</h1>
    <p>Generated: {{ generation_time }}</p>

    <div class="summary-card">
        <h2>Summary</h2>
        <ul>
            <li><strong>Total Statements:</strong> {{ result.statement_counts.values() | sum }}</li>
            <li><strong>Total Destructive Statements:</strong> {{ result.destructive_counts.values() | sum }}</li>
            <li><strong>Total Errors:</strong> {{ result.errors | length }}</li>
        </ul>
        <h3>Statement Counts</h3>
        <table>
            <thead><tr><th>Type</th><th>Count</th></tr></thead>
            <tbody>
            {% for stmt, count in result.statement_counts.items() %}
                <tr><td>{{ stmt }}</td><td>{{ count }}</td></tr>
            {% endfor %}
            </tbody>
        </table>
        <h3>Destructive Statement Counts</h3>
        <table>
            <thead><tr><th>Type</th><th>Count</th></tr></thead>
            <tbody>
            {% for stmt, count in result.destructive_counts.items() %}
                <tr><td>{{ stmt }}</td><td>{{ count }}</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="summary-card">
        <h2>Stage, File Format, and COPY INTO Details</h2>
        <table>
            <thead><tr><th>Type</th><th>Name</th><th>Action</th><th>File</th><th>Line</th></tr></thead>
            <tbody>
            {% for obj in result.objects_found if obj.object_type in ["STAGE", "FILE_FORMAT"] or "COPY_INTO" in obj.action %}
                <tr>
                    <td>{{ obj.object_type }}</td>
                    <td>{{ obj.name }}</td>
                    <td>{{ obj.action }}</td>
                    <td>{{ obj.file_path }}</td>
                    <td>{{ obj.line }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <h2>Errors</h2>
    {% if result.errors %}
    <table>
        <thead><tr><th>File</th><th>Line</th><th>Message</th></tr></thead>
        <tbody>
        {% for error in result.errors %}
            <tr class="error-message">
                <td>{{ error.file }}</td>
                <td>{{ error.line }}</td>
                <td>{{ error.message }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No errors found.</p>
    {% endif %}

    <h2>Object Interactions</h2>
    <table class="object-table">
        <thead><tr><th>Object Type</th><th>Object Name</th><th>Actions</th></tr></thead>
        <tbody>
        {% for obj_key, actions in object_interactions_sorted %}
            <tr>
                <td>{{ obj_key[0] }}</td>
                <td>{{ obj_key[1] }}</td>
                <td>{{ actions | join(', ') }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <details>
        <summary>Show Detailed Object Occurrences</summary>
        <table>
            <thead><tr><th>File</th><th>Line</th><th>Column</th><th>Type</th><th>Name</th><th>Action</th></tr></thead>
            <tbody>
            {% for obj in result.objects_found %}
                <tr>
                    <td>{{ obj.file_path }}</td>
                    <td>{{ obj.line }}</td>
                    <td>{{ obj.column }}</td>
                    <td>{{ obj.object_type }}</td>
                    <td>{{ obj.name }}</td>
                    <td>{{ obj.action }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </details>

    <footer style="margin-top:3em; color:#888; font-size:0.9em;">
        <p>Generated by SQL Analyzer &mdash; <code>--format html</code> output</p>
    </footer>
</body>
</html> 